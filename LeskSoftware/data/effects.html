<!DOCTYPE html>
<html>
<head>
  <title>Effects</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body >
  <h1 onclick="closePanel()">All the effects</h1>
  <p>Here are all the Lesk effects</p>
  <div id="effects-details"></div>

  <!-- Modal Bottom Sheet -->
  <div id="modal-sheet" class="modal-sheet closed">
    <div class="containerArrow">
      <div class="arr top"><img src="img/right-arrow.png" id="arrow" onclick="moveSheet()"></div>
    </div>
    <div class="grid-container">
        <div class="setting_item_left">
          <label class="brightness setting_name" for="brightness">Brightness</label>
            <div class="rangeAndNumber bri_range setting_range">
            <input type="range" id="brightness_range" name="brightness" class="setting_button" min="0" max="255">
            <div class="value_bri">0</div>
          </div>
        </div>
        <div class="setting_item_right">
          <label class="mic_input_title setting_name" for="mic_input_title">Mic</label>
          <div class="rangeAndNumber mic_range setting_range">
          <input type="range" id="mic_range" name="mic_range" class="mic_range_button setting_button" min="0" max="255">
          <div class="value_mic_input">0</div>
        </div>
      </div>
      <div id="settings-details"></div>
    </div>

    </div>
  </div>

  <script>
    fetch(`http://192.168.1.236/api/effects`)
      .then(response => {
        if(!response.ok) {
          throw new Error('Network response was not ok ' + response.statusText);
        }
          return response.json();
        })
      .then(data => {
        const effectsDiv = document.getElementById('effects-details');
          data.effects.forEach(effect => {
            const effectDiv = document.createElement('div');
            effectDiv.className = 'card';
            effectDiv.innerHTML = `<h2 class="card-title" ">${effect.name}</h2>`;
            effectDiv.onclick = function() {
              changeEffect(effect.name);
            };
            effect.settings.forEach(setting => {
              const settingsDiv = document.createElement('p');
              settingsDiv.innerHTML = `Settings: ${setting}`;
              effectDiv.appendChild(settingsDiv);
           })
           effectsDiv.appendChild(effectDiv);
          });
      })
      .catch(error => console.error('Error fetching collection details:', error));

      fetch(`http://192.168.1.236/api/settings`)
      .then(response => {
        if(!response.ok) {
          throw new Error('Network response was not ok ' + response.statusText);
        }
          return response.json();
        })
      .then(data => {
        const settingsDiv = document.getElementById('setting-details');
        var number = 0;
          data.effects.forEach(settings => {
            const effectDiv = document.createElement('div');
            if (number % 2 == 0) {
              effectDiv.className = 'setting_item_left';
            } else {
              effectDiv.className = 'setting_item_right';
            }
            number += 1;
            settings.settings.forEach(setting => {
              const settingsDiv = document.createElement('p');
              settingsDiv.innerHTML = `Settings: ${setting}`;
              effectDiv.appendChild(settingsDiv);
           })
           effectsDiv.appendChild(effectDiv);
          });
      })
      .catch(error => console.error('Error fetching collection details:', error));
      // Function to handle the effect change
    function changeEffect(effectName) {
      fetch('/effects', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: 'effect=' + encodeURIComponent(effectName)
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok ' + response.statusText);
        }
        return response.text();
      })
      .then(data => {
        console.log(data);  // For debugging
      })
      .catch(error => console.error('Error:', error));
    }

    


    function moveSheet() {
      if (document.getElementById("modal-sheet").classList.contains("closed")){
        document.getElementById("modal-sheet").classList.remove("closed");
        document.getElementById("modal-sheet").classList.add("open");
        document.getElementById("modal-sheet").style.bottom = '0%';
        document.getElementById("arrow").style.transition = 'transform 150ms ease-in';
        document.getElementById("arrow").style.transform = 'rotate(90deg)';
      } else {
        closePanel();
      }
    }

    function closePanel() {
      if (document.getElementById("modal-sheet").classList.contains("open")) {
        document.getElementById("modal-sheet").classList.remove("open");
        document.getElementById("modal-sheet").classList.add("closed");
        document.getElementById("modal-sheet").style.bottom = '-75%';
        document.getElementById("arrow").style.transition = 'transform 150ms ease-in';
        document.getElementById("arrow").style.transform = 'rotate(270deg)';
      }
    }


    const rangeInput = document.getElementById('brightness_range');
    // Listen for changes in the range input
    rangeInput.addEventListener('input', function() {
      console.log('Range value changed to:', rangeInput.value);
    });
    const sliderBrightness = document.getElementById('brightness_range');
    const sliderValueBrightness = document.querySelector(".value_bri")

    sliderBrightness.addEventListener("input", (event) => {
      console.log(sliderBrightness)
      const tempSliderValue = event.target.value; 
      sliderValueBrightness.textContent = tempSliderValue;
      
      const progress = (tempSliderValue / sliderBrightness.max) * 100;
    
    })

    const sliderMic = document.getElementById('mic_range');
    const sliderValueMicInput = document.querySelector(".value_mic_input")

    sliderMic.addEventListener("input", (event) => {
      console.log(sliderBrightness)
      const tempSliderValue = event.target.value; 
      sliderValueMicInput.textContent = tempSliderValue;
      
      const progress = (tempSliderValue / sliderMic.max) * 100;
    })
  

  </script>
</body>
</html>
